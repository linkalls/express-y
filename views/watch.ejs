<div class="container mx-auto mt-8 p-4 bg-white shadow-lg rounded-lg">
  <h1 class="text-3xl font-bold mb-4"><%= title %></h1>
  <div class="video-wrapper mb-8">
    <video id="my-video" class="video-js vjs-default-skin w-full h-full" controls preload="auto">
      <source src="https://www.youtube.com/watch?v=<%= videoId %>" type="video/youtube" />
    </video>
    <audio id="audioPlayer" src="<%= audioUrl %>" type="audio/webm"></audio>
  </div>
  <div class="mb-8">
    <h2 class="text-2xl font-semibold mb-2">Description</h2>
    <p class="text-gray-700"><%- description %></p>
  </div>
  <div class="recommendations">
    <h2 class="text-2xl font-semibold mb-4">Recommendations</h2>
    <ul class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
      <% recommendations.forEach(recommendation => { %>
      <li class="bg-gray-100 p-4 rounded-lg shadow-md">
        <a href="/watch?v=<%= recommendation.videoId %>" class="block">
          <img src="<%= recommendation.videoThumbnails[0].url %>" alt="<%= recommendation.title %>" class="w-full h-32 object-cover rounded-md mb-2" />
          <span class="text-lg font-semibold text-gray-900"><%= recommendation.title %></span>
        </a>
      </li>
      <% }); %>
    </ul>
  </div>
</div>

<style>
  .container {
    max-width: 1200px;
  }
  .video-wrapper {
    position: relative;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
    height: 0;
    overflow: hidden;
  }
  .video-js {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
</style>

<script>
  var player = videojs("my-video", {
    techOrder: ["youtube"],
    plugins: {
      videoJsResolutionSwitcher: {
        default: "high",
        dynamicLabel: true,
      },
      httpSourceSelector: {},
      qualityLevels: {},
      markers: {
        markers: [
          { time: 9.5, text: "Marker 1" },
          { time: 16, text: "Marker 2" },
        ],
      },
      mobileUi: {},
      share: {},
      vr: {},
    },
  });

  const audioPlayer = document.getElementById("audioPlayer");
  let syncTimer;

  function syncAudioVideo() {
    if (Math.abs(player.currentTime() - audioPlayer.currentTime) > 0.1) {
      audioPlayer.currentTime = player.currentTime();
    }
  }

  function setupSync() {
    clearInterval(syncTimer);
    syncTimer = setInterval(syncAudioVideo, 100);
  }

  function pauseAudio() {
    audioPlayer.pause();
    clearInterval(syncTimer);
  }

  function playAudio() {
    audioPlayer.play().catch((error) => {
      console.error("Error playing audio:", error);
    });
    setupSync();
  }

  player.on("play", () => {
    audioPlayer.currentTime = player.currentTime();
    playAudio();
  });

  player.on("pause", () => {
    pauseAudio();
  });

  player.on("seeking", () => {
    audioPlayer.currentTime = player.currentTime();
  });

  player.on("waiting", () => {
    pauseAudio();
  });

  player.on("canplay", () => {
    playAudio();
  });

  player.on("ended", () => {
    pauseAudio();
  });

  audioPlayer.addEventListener("ended", () => {
    player.pause();
    clearInterval(syncTimer);
  });

  // ビデオプレーヤーの音声を無効にする
  player.muted(true);
</script>